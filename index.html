<label for="midi-nr">Midi Note Nr</label>
<input type="number" name="midi-nr" id="midi-nr">
<label for="midi-name">Note Name</label>
<input type="text" name="midi-name" id="midi-name">
<label for="base">Pitch Standart</label>
<input type="number" name="base" id="base" value="440">
<label for="freq">Frequency</label>
<input type="text" name="freq" id="freq">

<div class="keys--container">
  <div class="oct-sel--container">
    <a href="#" class="oct-sel" id="oct-min">-</a>
    <span class="oct-cur" id="oct-cur">3</span>
    <a href="#" class="oct-sel" id="oct-pls">+</a>
  </div>

  <div id="keys"></div>
</div>

<script>
  window.addEventListener('load', loaded);
  function loaded() {

    const midiNr = document.getElementById('midi-nr');
    const midiName = document.getElementById('midi-name');
    const base = document.getElementById('base');
    const freq = document.getElementById('freq');
  
    const octave = document.getElementById('oct-cur');
    const octMin = document.getElementById('oct-min');
    const octPls = document.getElementById('oct-pls');
    const keys = document.getElementById('keys');
  
    const midi2Freq = (_midiNr, _base) => {
      return 2**((_midiNr - 69) / 12) * _base;
    };
    const midi2Oct = (_midiNr) => {
      const octave = (_midiNr / 12) - 1;
      const index = _midiNr % 12;
      return [Math.floor(octave), index];
  
    }
    const midi2Name = (_midiNr) => {
      const notes = "C C# D D# E F F# G G# A A# B";
      const [octave, index] = midi2Oct(_midiNr);
      const name = notes.split(' ')[index]+ `${Math.floor(octave)}`;
      return name;
    }
  
    const setKeys = (_note, _oct) => {
      octave.innerHTML = _oct;
    }
  
    const setAll = (val) => {
      const name = midi2Name(val);
      const [octave, index] = midi2Oct(val);
      midiName.value = name;
  
      const baseFreq = base.value || 440;
      const resFreq = midi2Freq(val, baseFreq);
      freq.value = resFreq;
  
      setKeys(index, octave);
  
    }
  
    const createKeys = (_parent) => {
      let allKeys = [];
      let allOcts = [];
      const notes = "C C# D D# E F F# G G# A A# B";
      for (let i = 0; i < 12; i++) {
        const el = document.createElement('a');
        el.classList.add('key');
        el.classList.add(`key-${i}`);
        el.textContent = notes.split(' ')[i];
        const oct = document.createElement('span');
        oct.classList.add('key-oct');
        oct.textContent = octave.textContent || 3;
        if ([1, 3, 6, 8, 10].includes(i)) {
          el.classList.add("key-black");
        }
        
        el.appendChild(oct);
        _parent.appendChild(el);
        allKeys.push(el);
        allOcts.push(oct);
      }
    }
  
    midiNr.addEventListener('change', (e) => {
      const val = Math.floor(e.target.value);
      if (val < 21 || val > 127) {
        //Add proper Error Msg
        console.log("Range");
        return;
      }
      setAll(val);
    });

    createKeys(keys);
  }
</script>